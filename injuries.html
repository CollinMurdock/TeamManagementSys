<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Injuries Page</title>
    <link rel="import" href="includes/head.html">
    <link rel="stylesheet" type="text/css" href="includes/Style.css">
</head>
<body>
    <header>
        <nav class="navbar navbar-inverse">
            <div class="navbar-header">
                <a class="navbar-brand" href="index.html">Team Management System</a>
            </div>
            <ul class="nav navbar-nav">
                <li><a href="injuries.html">Injury Page</a></li>
                <li><a href="contract.html">Player Contract Page</a></li>
            </ul>
        </nav>
    </header>
    <h1>View Injuries</h1>

    <span>View all current injuries</span>
    <label class="switch">
        <input id="injury-switch" type="checkbox" />
        <span class="slider round"></span>
    </label>

    <form >
        <div class="form-group col-md-3">
            <label>Select Player</label>
            <select class="form-control" id="player-select">
                
            </select>
        </div>
    </form>

    <div id="all-injuries" style="display:none;">
        <table class="table" style="max-width:800px;">
            <thead class="thead-dark">
                <tr>
                    <th>Name</th>
                    <th>Injury Date</th>
                    <th>Injury Description</th>
                    <th>Estimated Return</th>
                </tr>
            </thead>
            <tbody id="bodyAllInjuries"></tbody>
        </table>
    </div>


    <div id="player-injuries" style="display:none;">
        <h2>Injury History for: </h2>
        <table class="table" style="max-width:800px;">
            <thead class="thead-dark">
                <tr>
                    <th>Injury Date</th>
                    <th>Injury Description</th>
                    <th>Injury Return</th>
                </tr>
            </thead>
            <tbody id="bodyAllInjuries"></tbody>
        </table>
    </div>
    <script>
        function getCurrentInjuries() {
            
            service("getCurrentInjuries", "{}", function (data) {
                console.log(data);
                var d = "";
                $.each(data, function (index, value) {
                    var regEx = /\d+/g;
                    var dI = new Date(parseInt(value.dateInjured.match(regEx)));
                    var dateInjuredString = dI.getMonth() + '-' + dI.getDate() + '-' + dI.getFullYear();
                    var dR = new Date(parseInt(value.returnDate.match(regEx)));
                    var dateReturnString = dR.getMonth() + '-' + dR.getDate() + '-' + dR.getFullYear();

                    d += '<tr>'
                    d += '<td>' + value.name + '</td>';
                    d += '<td>' + dateInjuredString + '</td>';
                    d += '<td>' + dateReturnString + '</td>';
                    d += '<td>' + value.injuryDescription + '</td>';
                    d += '</tr>';
                });
                $("#bodyAllInjuries").html(d);
            }, function () { console.log("fail") });

        }

        function addPlayerNames() {
            service("getAllPlayers", "{}",
                function (data) {
                    console.log(data);
                    var d = '';
                    $.each(data, function (index, value) {
                        
                        d += '<option id="' + value.playerId + '">' + value.name + '</option>';
                    });
                    $("#player-select").html(d);
                }, function () {

                }
            );
        }

        $("#player-select").change(function () {
            service("")

            $("#player-injuries").css("display", "block");
        });


        $("#injury-switch").change(function () {
            if (this.checked) {
                $("#player-injuries").css("display", "none");
                $("#all-injuries").css("display", "block");
                $("#player-select").css("display", "none");
            } else {
                $("#all-injuries").css("display", "none");
                $("#player-select").css("display", "block");
            }
        });
        function showDetails(id) {
            alert("You selected id: " + id);
        }

        getCurrentInjuries();
        addPlayerNames();

    </script>
</body>
</html>

