<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Players Page</title>
    <link rel="import" href="includes/head.html">
</head>
<body>
    <header>

        <nav class="navbar navbar-inverse">
            <div class="navbar-header">
                <a class="navbar-brand" href="index.html">Team Management System</a>
            </div>
            <ul class="nav navbar-nav">
                <li><a href="injuries.html">Injury page</a></li>
            </ul>
        </nav>
    </header>
    <h1>View Players</h1>
    <div class="container">
        <div class="row">
            <div class="col-lg-6">
                <table id="player-table" class="table">
                    <thead class="thead-dark">
                        <tr>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Age</th>
                            <th>Weight</th>
                            <th>Height</th>
                        </tr>
                    </thead>
                    <tbody id="bodyAllPlayers"></tbody>
                </table>
            </div>
            <div class="col-lg-6 stats">
                <table id="stats-table" class="table">
                    <thead class="thead-dark">
                        <tr id="stats-head">
                            <th>Season</th>
                            <th>Games Played</th>
                            <th>Points</th>
                            <th>Assists</th>
                            <th>Rebounds</th>
                            <th>Steals</th>
                            <th>Blocks</th>
                            <th>Turnovers</th>
                            <th><button class="averages-button btn">View Averages</button></th>
                            <th><button class="totals-button btn">View Totals</button></th>
                        </tr>
                    </thead>
                    <tbody id="bodyStats"></tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        function getAllPlayers() {
            service("getAllPlayers", "{}", function (data) {
                var d = "";
                $.each(data, function (index, value) {

                    var regEx = /\d+/g;
                    var dob = new Date(parseInt(value.dob.match(regEx)));
                    var today = new Date();
                    var diff = today - dob;
                    var age = parseInt((diff / 1000 / 60 / 60 / 24) / 365);

                    d += '<tr id=player' + value.playerID + '><td>' + value.name + '</td>';
                    d += '<td>' + value.position + '</td>';
                    d += '<td>' + age + '</td>';
                    d += '<td>' + value.weight + '</td>';
                    d += '<td>' + value.height + '</td>';
                    d += '<td><button class="stats-button btn" onclick=getPlayerStats(' + value.playerID + ')>View Stats</button></td>';
                    d += '</tr>';

                });
                $("#bodyAllPlayers").html(d);

            }, function () { console.log("fail") });


        }

        function getPlayerStats(id) {
            console.log('hey' + id);

            service("getPlayerStats", "{id: " + id + "}", function (data) {

                var d = "";
                $.each(data, function (index, value) {

                    d += '<tr>';
                    d += '<td> ' + value.season + '</td >';
                    d += '<td> ' + value.gamesPlayed + '</td >';
                    d += '<td> ' + value.points + '</td >';
                    d += '<td> ' + value.assists + '</td >';
                    d += '<td> ' + value.rebounds + '</td >';
                    d += '<td> ' + value.steals + '</td >';
                    d += '<td> ' + value.blocks + '</td >';
                    d += '<td> ' + value.turnovers + '</td >';
                    
                    d += '</tr > ';


                });
                $("#bodyStats").html(d);
                $(".stats").css("display", "inline-block");
                $(".totals-button").css("display", "none");
                $(".averages-button").css("display", "inline");
                $(".averages-button").attr('onclick', 'getPlayerAverages(' + id + ')');
                
            }, function () { console.log("fail") });
        }

        function getPlayerAverages(id) {
            service("getPlayerAverages", "{id: " + id + "}", function (data) {

                var d = "";
                $.each(data, function (index, value) {

                    d += '<tr>';
                    d += '<td> ' + value.season + '</td >';
                    d += '<td> ' + value.gamesPlayed + '</td >';
                    d += '<td> ' + value.points.toFixed(2) + '</td >';
                    d += '<td> ' + value.assists.toFixed(2) + '</td >';
                    d += '<td> ' + value.rebounds.toFixed(2) + '</td >';
                    d += '<td> ' + value.steals.toFixed(2) + '</td >';
                    d += '<td> ' + value.blocks.toFixed(2) + '</td >';
                    d += '<td> ' + value.turnovers.toFixed(2) + '</td >';
                    d += '</tr> ';


                });
                $("#bodyStats").html(d);
                $(".stats").css("display", "inline-block");
                $(".averages-button").css("display", "none");
                $(".totals-button").css("display", "inline");
                $(".totals-button").attr('onclick', 'getPlayerStats(' + id + ')');

            }, function () { console.log("fail") });
        }



        getAllPlayers();
    </script>
</body>
</html>

